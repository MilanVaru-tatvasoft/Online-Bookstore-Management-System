@model DataAccess.CustomModels.OrderListModel;
@functions {
    public string? getStatus(int? statusId)
    {
        string? status = Model.statuses?.FirstOrDefault(c => c.StatusId == statusId).StatusName;
        return status;
    }
}
<div class="container-fluid">

    <h4 class="mt-4">Orders Dashboard</h4>

    <div class="my-2 py-3 p-1 p-md-3">
        <form id="searchForm" method="post" action="/Orders/Search">
            <div class="row d-flex m-2 gy-2">

                <div class="form-group col-md-3 col-6">
                    <input type="text" class="form-control" id="orderName" name="orderName" placeholder="Order Name">
                </div>
                <div class="form-group col-md-3 col-6">
                    <input type="text" class="form-control" id="customer" name="customer" placeholder="Customer">
                </div>
                <div class="form-group col-md-3 col-6">
                    <input type="text" class="form-control" id="city" name="city" placeholder="City">
                </div>
                <div class="form-group col-md-3 col-6">
                    <input type="date" class="form-control" id="orderDate" name="orderDate" placeholder="Order ID" max="@DateTime.Today.Date">
                </div>
            </div>
            <div class="d-flex justify-content-end gap-2">
                <button type="button" id="searchBtn" class="btn btn-primary">Search</button>
                <button type="reset" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
    <div class="table table-responsive  p-3">
        <table id="ordersTable" class="display " style="width:100%">
            <thead class="bg-body-tertiary">
                <tr>
                    <th>Order Name</th>
                    <th>Customer</th>
                    <th>Price($)</th>
                    <th>Quantity</th>
                    <th>Total Amount($)</th>
                    <th>Address</th>
                    <th>Order Date</th>
                    <th>Status</th>
                    <th>City</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white">
                @if (Model.orderdetails.Count() != 0)
                {

                    @foreach (var i in Model.orderdetails)
                    {
                        var statusid = Model.orders?.FirstOrDefault(x => x.Orderid == i.Orderid).Orderstatusid;
                        <tr >
                            <td>@i.Orderdetailid @Model.books.FirstOrDefault(x=>x.Bookid == i.Bookid).Title</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Customername</td>
                            <td>@Model.books?.FirstOrDefault(x=>x.Bookid == i.Bookid).Price</td>
                            <td>@i.Quantity</td>
                            <td>@i.Totalamount</td>

                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Address</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Orderdate.ToString("yyyy-MM-dd")</td>
                            <td>@getStatus(statusid)</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).City</td>
                            <td>
                                <div class="d-flex justify-content-center gap-2 w-auto">
                                    <button class="btn btn-info">
                                        <i class="bi bi-eye-fill text-white d-md-none d-block"></i>
                                        <span class="d-none d-md-block">View</span>
                                    </button>
                                    <button class="btn btn-danger">Delete </button>
                                </div>

                            </td>
                        </tr>
                    }
                }


            </tbody>
        </table>

    </div>
</div>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        var table = $('#ordersTable').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [[5, 10, -1], [5, 10, "All"]],
            "pageLength": 5,
            language: {
                oPaginate: {
                    sNext: '<i class="bi bi-caret-right-fill text-info"></i>',
                    sPrevious: '<i class="bi bi-caret-left-fill text-info"></i>'
                }

            }
        });
        $('.dataTables_filter').hide();
        $('#ordersTable_first').hide();
        $('#ordersTable_last').hide();

        $('#searchBtn').on('click', function () {
            table.columns(0).search($('#orderName').val().trim());
            table.columns(1).search($('#customer').val().trim());
            table.columns(8).search($('#city').val().trim());
            table.columns(6).search($('#orderDate').val().trim());
            table.draw();
            $('.dataTables_filter').hide();
            $('#ordersTable_first').hide();
            $('#ordersTable_last').hide();
        });

        $('button[type="reset"]').on('click', function () {
            GetOrderList()
        });
    });
</script>
<script>
    function getViewOrder(orderDetailId) {
        $.ajax({
            method: "GET",
            url: "/Admin/getViewOrder",
            data: { orderDetailId: orderDetailId },
            success: function (result) {
                $('#AdminDash').empty()
                $('#AdminDash').html(result)
            },
            error: function () {
                alert('Error loading partial view');
            }
        });
    }
</script>
