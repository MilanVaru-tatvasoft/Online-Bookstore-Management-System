@model DataAccess.CustomModels.OrderListModel;
@functions {
    public string? getStatus(int? statusId)
    {
        string? status = Model.statuses?.FirstOrDefault(c => c.StatusId == statusId).StatusName;
        return status;
    }
}
<div class="container-fluid">

    <h4 class="mt-4">Orders Dashboard</h4>

    <div class="my-2 py-3 p-1 p-md-3">
        <form id="searchForm" method="post" action="/Orders/Search">
            <div class="row d-flex m-2 gy-2">
                <div class="form-group col-md-3 col-6">
                    <input type="text" class="form-control" id="customer" name="customer" placeholder="Customer">
                </div>
                <div class="form-group col-md-3 col-6">
                    <input type="email" class="form-control" id="email" name="email" placeholder="email ">
                </div>
               
                <div class="form-group col-md-3 col-6">
                    <input type="text" class="form-control" id="city" name="city" placeholder="City">
                </div>
                <div class="form-group col-md-3 col-6">
                    <input type="date" class="form-control" id="orderDate" name="orderDate" placeholder="Order ID" max="@DateTime.Today.Date">
                </div>
                <div class="form-group col-md-3 col-6">
                    <select class="form-select" aria-label="Default select example" onchange="getStatus(this.value)">
                        <option selected>all</option>
                        @foreach (var x in Model.statuses.ToList())
                        {
                            <option value="@x.StatusName">@x.StatusName</option>
                        }

                    </select>
                    <input type="text" id="statusname" hidden />
                </div>
            </div>
            <div class="d-flex justify-content-end gap-2">
                <button type="button" id="searchBtn" class="btn btn-primary">Search</button>
                <button type="reset" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
    <div class="table table-responsive  p-3">
        <table id="ordersTable" class="display " style="width:100%">
            <thead class="bg-body-tertiary">
                <tr>
                    <th>OrderId</th>
                    <th>Order Date</th>
                    <th>Delivery Date</th>
                    <th>Customer</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Address</th>
                    <th>City</th>
                    <th>Quantity/Total amount</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white">
                @if (Model.orders.Count() != 0)
                {

                    @foreach (var i in Model.orders.OrderBy(x=>x.Orderdate))
                    {
                        var statusid = Model.orders?.FirstOrDefault(x => x.Orderid == i.Orderid).Orderstatusid;
                        <tr>
                            <td>@i.Orderid</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Orderdate.ToString("yyyy-MM-dd")</td>
                            <td>-</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Customername</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Email</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Phonenumber</td>

                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).Address</td>
                            <td>@Model.orders?.FirstOrDefault(x=>x.Orderid == i.Orderid).City</td>
                            <td>@Model.orderdetails.FirstOrDefault(x=>x.Orderid == i.Orderid).Quantity/ $ @i.Totalamount</td>
                            <td>@getStatus(statusid)</td>
                            <td>
                                <div class="d-flex justify-content-center gap-2 w-auto">
                                    <button class="btn btn-info">
                                        <i class="bi bi-pencil-square"></i>
                                    </button>
                                    <button class="btn btn-danger">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </div>

                            </td>
                        </tr>
                    }
                }


            </tbody>
        </table>

    </div>
</div>

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">

<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        var table = $('#ordersTable').DataTable({
            "pagingType": "full_numbers",
            "lengthMenu": [[5, 10, -1], [5, 10, "All"]],
            "pageLength": 5,
            language: {
                oPaginate: {
                    sNext: '<i class="bi bi-caret-right-fill text-info"></i>',
                    sPrevious: '<i class="bi bi-caret-left-fill text-info"></i>'
                }

            }
        });
        $('.dataTables_filter').hide();
        $('#ordersTable_first').hide();
        $('#ordersTable_last').hide();

        $('#searchBtn').on('click', function () {
            table.columns(4).search($('#email').val().trim());
            table.columns(3).search($('#customer').val().trim());
            table.columns(7).search($('#city').val().trim());
            table.columns(1).search($('#orderDate').val().trim());
            table.columns(9).search($('#statusname').val().trim());
            table.draw();
            $('.dataTables_filter').hide();
            $('#ordersTable_first').hide();
            $('#ordersTable_last').hide();
        });

        $('button[type="reset"]').on('click', function () {
            GetOrderList()
        });
    });
</script>
<script>
    function getViewOrder(orderDetailId) {
        $.ajax({
            method: "GET",
            url: "/Admin/getViewOrder",
            data: { orderDetailId: orderDetailId },
            success: function (result) {
                $('#AdminDash').empty()
                $('#AdminDash').html(result)
            },
            error: function () {
                alert('Error loading partial view');
            }
        });
    }
    function getStatus(value) {
        $('#statusname').val(value);
    }
</script>
